package org.e11eman.crackutilities.utilities;

import com.google.gson.Gson;
import com.google.gson.JsonElement;
import com.google.gson.JsonObject;
import net.minecraft.client.MinecraftClient;
import org.e11eman.crackutilities.wrappers.Player;

import java.util.Map;
import java.util.Objects;

public class Exploits {
    public static void entityBypassA(double x, double y, double z, String mobType, String json) {
        int simDistance = Objects.requireNonNull(MinecraftClient.getInstance().world).getSimulationDistance() * 16;
        String randomizedTag = "cbp" + SecureRandomStuff.getRandomString(12) + Player.getPlayer().getGameProfile().getName();

        CClient.commandCoreSystem.run(String.format("summon %s %s %s %s %s",
                mobType, x + simDistance, y + simDistance, z + simDistance,
                "{Tags:[" + randomizedTag + "]}"
        ));

        CClient.commandCoreSystem.run(
                String.format("execute as @e[limit=1,tag=%s] run data modify entity @s Pos set value [%sd,%sd,%sd]", randomizedTag, x, y, z)
        );

        CClient.commandCoreSystem.run(
                String.format("data merge entity @e[limit=1,tag=%s] %s", randomizedTag, json)
        );
    }

    public static void entityBypassB(double x, double y, double z, String mobType, String json) {
        int simDistance = Objects.requireNonNull(MinecraftClient.getInstance().world).getSimulationDistance() * 16;
        String randomizedTag = "cbp" + SecureRandomStuff.getRandomString(12) + Player.getPlayer().getGameProfile().getName();

        JsonObject baseJson = new Gson().fromJson("{Tags:[" + randomizedTag + "]}", JsonObject.class);
        JsonObject extraJson = new Gson().fromJson(json, JsonObject.class);

        JsonObject merged = new JsonObject();

        for(Map.Entry<String, JsonElement> i : baseJson.entrySet()) {
            merged.add(i.getKey(), i.getValue());
        }

        for(Map.Entry<String, JsonElement> i : extraJson.entrySet()) {
            merged.add(i.getKey(), i.getValue());
        }

        CClient.commandCoreSystem.run(String.format("summon %s %s %s %s %s",
                mobType, x + simDistance, y + simDistance, z + simDistance,
                merged
        ));

        CClient.commandCoreSystem.run(
                String.format("execute as @e[limit=1,tag=%s] run data modify entity @s Pos set value [%sd,%sd,%sd]", randomizedTag, x, y, z)
        );
    }
}
